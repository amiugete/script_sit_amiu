#!/usr/bin/env python
# -*- coding: utf-8 -*-

# AMIU copyleft 2023
# Roberto Marzocchi

'''
Data una query specifica che restituisce un elenco di ID_SCHEDE forzo il salvataggio della scheda Ekovision per fare in modo che i dati vengano riprocessati da AMIU


'''

#from msilib import type_short
import os, sys, re  # ,shutil,glob

import requests
from requests.exceptions import HTTPError

import json


#import getopt  # per gestire gli input

#import pymssql

from datetime import date, datetime, timedelta


import xlsxwriter

import psycopg2

import cx_Oracle

currentdir = os.path.dirname(os.path.realpath(__file__))
parentdir = os.path.dirname(currentdir)
sys.path.append(parentdir)
from credenziali import *



# per mandare file a EKOVISION
import pysftp


#import requests

import logging


path=os.path.dirname(sys.argv[0]) 
nome=os.path.basename(__file__).replace('.py','')
#tmpfolder=tempfile.gettempdir() # get the current temporary directory
logfile='{0}/log/{1}.log'.format(path,nome)
errorfile='{0}/log/error_{1}.log'.format(path,nome)
#if os.path.exists(logfile):
#    os.remove(logfile)







# Create a custom logger
logging.basicConfig(
    level=logging.DEBUG,
    handlers=[
    ]
)

logger = logging.getLogger()

# Create handlers
c_handler = logging.FileHandler(filename=errorfile, encoding='utf-8', mode='w')
f_handler = logging.StreamHandler()
#f_handler = logging.FileHandler(filename=logfile, encoding='utf-8', mode='w')


c_handler.setLevel(logging.ERROR)
f_handler.setLevel(logging.INFO)


# Add handlers to the logger
logger.addHandler(c_handler)
logger.addHandler(f_handler)


cc_format = logging.Formatter('%(asctime)s\t%(levelname)s\t%(message)s')

c_handler.setFormatter(cc_format)
f_handler.setFormatter(cc_format)


# libreria per invio mail
import email, smtplib, ssl
import mimetypes
from email.mime.multipart import MIMEMultipart
from email import encoders
from email.message import Message
from email.mime.audio import MIMEAudio
from email.mime.base import MIMEBase
from email.mime.image import MIMEImage
from email.mime.text import MIMEText
from invio_messaggio import *

# libreria per scrivere file csv
import csv

import uuid

    
     

def main():
      


    
    # Get today's date
    #presentday = datetime.now() # or presentday = datetime.today()
    oggi=datetime.today()
    oggi=oggi.replace(hour=0, minute=0, second=0, microsecond=0)
    oggi=date(oggi.year, oggi.month, oggi.day)
    logging.debug('Oggi {}'.format(oggi))
    
    
    check=0
    
    headers = {'Content-Type': 'application/x-www-form-urlencoded'}
    
    #headers = {'Content-type': 'application/json;'}

    auth_data_eko={'user': eko_user, 'password': eko_pass, 'o2asp' :  eko_o2asp}
    
    
    
    # Mi connetto al DB oracle UO
    cx_Oracle.init_oracle_client(percorso_oracle) # necessario configurare il client oracle correttamente
    #cx_Oracle.init_oracle_client() # necessario configurare il client oracle correttamente
    parametri_con='{}/{}@//{}:{}/{}'.format(user_uo,pwd_uo, host_uo,port_uo,service_uo)
    logger.debug(parametri_con)
    con = cx_Oracle.connect(parametri_con)
    logger.info("Versione ORACLE: {}".format(con.version))
    
    cur = con.cursor()
    
    
    
    # inserimento manuale id_scheda
    #check_schede=[[483442],[483443]]
    check_schede=[
       [642503], [642495], [642499], [642496], [642497], [642498], [642502], [642500], [642477], [642494], [642493], [642478], [642479], [642480], [642489], [642501], [642481], [642473], [642487], [642488], [642482], [642474], [642483], [642484], [642485], [642475], [642486], [642476], [642491], [642492], [642490], [642534], [642526], [642530], [642527], [642528], [642529], [642533], [642531], [642508], [642525], [642524], [642509], [642510], [642511], [642520], [642532], [642512], [642504], [642518], [642519], [642513], [642505], [642514], [642515], [642516], [642506], [642517], [642507], [642522], [642523], [642521], [642565], [642557], [642561], [642558], [642559], [642560], [642564], [642562], [642539], [642556], [642555], [642540], [642541], [642542], [642551], [642563], [642543], [642535], [642549], [642550], [642544], [642536], [642545], [642546], [642547], [642537], [642548], [642538], [642553], [642554], [642552], [642596], [642588], [642592], [642589], [642590], [642591], [642595], [642593], [642570], [642587], [642586], [642571], [642572], [642573], [642582], [642594], [642574], [642566], [642580], [642581], [642575], [642567], [642576], [642577], [642578], [642568], [642579], [642569], [642584], [642585], [642583], [642625], [642618], [642619], [642620], [642621], [642624], [642622], [642601], [642617], [642616], [642602], [642604], [642603], [642612], [642623], [642605], [642597], [642610], [642611], [642606], [642598], [642607], [642608], [642599], [642609], [642600], [642614], [642615], [642613], [642626], [642627], [642629], [642630], [642628], [648516], [648508], [648512], [648509], [648510], [648511], [648515], [648513], [648490], [648507], [648506], [648491], [648492], [648493], [648502], [648514], [648494], [648486], [648500], [648501], [648495], [648487], [648496], [648497], [648498], [648488], [648499], [648489], [648504], [648505], [648503], [648547], [648539], [648543], [648540], [648541], [648542], [648546], [648544], [648521], [648538], [648537], [648522], [648523], [648524], [648533], [648545], [648525], [648517], [648531], [648532], [655392], [648526], [648518], [648527], [648528], [648529], [648519], [648530], [648520], [648535], [648536], [648534], [648578], [648570], [648574], [648571], [648572], [648573], [648577], [648575], [648552], [648569], [648568], [648553], [648554], [648555], [648564], [648576], [648556], [648548], [648562], [648563], [655472], [655474], [648557], [648549], [648558], [648559], [648560], [648550], [648561], [648551], [648566], [648567], [648565], [648609], [648601], [648605], [648602], [648603], [648604], [648608], [648606], [648583], [648600], [648599], [648584], [648585], [648586], [648595], [648607], [648587], [648579], [648593], [648594], [655396], [648588], [648580], [648589], [648590], [648591], [648581], [648592], [648582], [648597], [648598], [648596], [648640], [648632], [648636], [648633], [648634], [648635], [648639], [648637], [648614], [648631], [648630], [648615], [648616], [648617], [648626], [648638], [648618], [648610], [648624], [648625], [655393], [648619], [648611], [648620], [648621], [648622], [648612], [648623], [648613], [648628], [648629], [648627], [648669], [648662], [648663], [648664], [648665], [648668], [648666], [648645], [648661], [648660], [648646], [648648], [648647], [648656], [648667], [648649], [648641], [648654], [648655], [655476], [648650], [648642], [648651], [648652], [648643], [648653], [648644], [648658], [648659], [648657], [648670], [648671], [648673], [648674], [648672], [654499], [654491], [654495], [654492], [654493], [654494], [654498], [654496], [654473], [654490], [654489], [654474], [654475], [654476], [654485], [654497], [654477], [654469], [654483], [654484], [655397], [654478], [654470], [654479], [654480], [654481], [654471], [654482], [654472], [654487], [654488], [654486], [654530], [654522], [654526], [654523], [654524], [654525], [654529], [654527], [654504], [654521], [654520], [654505], [654506], [654507], [654516], [654528], [654508], [654500], [654514], [654515], [655394], [654509], [654501], [654510], [654511], [654512], [654502], [654513], [654503], [654518], [654519], [654517], [654561], [654553], [654557], [654554], [654555], [654556], [654560], [654558], [654535], [654552], [654551], [654536], [654537], [654538], [654547], [654559], [654539], [654531], [654545], [654546], [655473], [655475], [654540], [654532], [654541], [654542], [654543], [654533], [654544], [654534], [654549], [654550], [654548], [654592], [654584], [654588], [654585], [654586], [654587], [654591], [654589], [654566], [654583], [654582], [654567], [654568], [654569], [654578], [654590], [654570], [654562], [654576], [654577], [655398], [654571], [654563], [654572], [654573], [654574], [654564], [654575], [654565], [654580], [654581], [654579], [654623], [654615], [654619], [654616], [654617], [654618], [654622], [654620], [654597], [654614], [654613], [654598], [654599], [654600], [654609], [654621], [654601], [654593], [654607], [654608], [655395], [654602], [654594], [654603], [654604], [654605], [654595], [654606], [654596], [654611], [654612], [654610], [654652], [654645], [654646], [654647], [654648], [654651], [654649], [654628], [654644], [654643], [654629], [654631], [654630], [654639], [654650], [654632], [654624], [654637], [654638], [655477], [654633], [654625], [654634], [654635], [654626], [654636], [654627], [654641], [654642], [654640], [654653], [654654], [654656], [654657], [654655], [660596], [660588], [660592], [660589], [660590], [660591], [660595], [660593], [660570], [660587], [660586], [660571], [660572], [660573], [660582], [660594], [660574], [660566], [660580], [660581], [660597], [660575], [660567], [660576], [660577], [660578], [660568], [660579], [660569], [660584], [660585], [660583], [660628], [660620], [660624], [660621], [660622], [660623], [660627], [660625], [660602], [660619], [660618], [660603], [660604], [660605], [660614], [660626], [660606], [660598], [660612], [660613], [660629], [660607], [660599], [660608], [660609], [660610], [660600], [660611], [660601], [660616], [660617], [660615], [660660], [660652], [660656], [660653], [660654], [660655], [660659], [660657], [660634], [660651], [660650], [660635], [660636], [660637], [660646], [660658], [660638], [660630], [660644], [660645], [660661], [660662], [660639], [660631], [660640], [660641], [660642], [660632], [660643], [660633], [660648], [660649], [660647], [660693], [660685], [660689], [660686], [660687], [660688], [660692], [660690], [660667], [660684], [660683], [660668], [660669], [660670], [660679], [660691], [660671], [660663], [660677], [660678], [660694], [660672], [660664], [660673], [660674], [660675], [660665], [660676], [660666], [660681], [660682], [660680], [660725], [660717], [660721], [660718], [660719], [660720], [660724], [660722], [660699], [660716], [660715], [660700], [660701], [660702], [660711], [660723], [660703], [660695], [660709], [660710], [660726], [660704], [660696], [660705], [660706], [660707], [660697], [660708], [660698], [660713], [660714], [660712], [660755], [660748], [660749], [660750], [660751], [660754], [660752], [660731], [660747], [660746], [660732], [660734], [660733], [660742], [660753], [660735], [660727], [660740], [660741], [660756], [660736], [660728], [660737], [660738], [660729], [660739], [660730], [660744], [660745], [660743], [660757], [660758], [660760], [660761], [660759], [666648], [666640], [666644], [666641], [666642], [666643], [666647], [666645], [666622], [666639], [666638], [666623], [666624], [666625], [666634], [666646], [666626], [666618], [666632], [666633], [666649], [666627], [666619], [666628], [666629], [666630], [666620], [666631], [666621], [666636], [666637], [666635], [666680], [666672], [666676], [666673], [666674], [666675], [666679], [666677], [666654], [666671], [666670], [666655], [666656], [666657], [666666], [666678], [666658], [666650], [666664], [666665], [666681], [666659], [666651], [666660], [666661], [666662], [666652], [666663], [666653], [666668], [666669], [666667], [666712], [666704], [666708], [666705], [666706], [666707], [666711], [666709], [666686], [666703], [666702], [666687], [666688], [666689], [666698], [666710], [666690], [666682], [666696], [666697], [666713], [666714], [666691], [666683], [666692], [666693], [666694], [666684], [666695], [666685], [666700], [666701], [666699], [666745], [666737], [666741], [666738], [666739], [666740], [666744], [666742], [666719], [666736], [666735], [666720], [666721], [666722], [666731], [666743], [666723], [666715], [666729], [666730], [666746], [666724], [666716], [666725], [666726], [666727], [666717], [666728], [666718], [666733], [666734], [666732], [666777], [666769], [666773], [666770], [666771], [666772], [666776], [666774], [666751], [666768], [666767], [666752], [666753], [666754], [666763], [666775], [666755], [666747], [666761], [666762], [666778], [666756], [666748], [666757], [666758], [666759], [666749], [666760], [666750], [666765], [666766], [666764], [666807], [666800], [666801], [666802], [666803], [666806], [666804], [666783], [666799], [666798], [666784], [666786], [666785], [666794], [666805], [666787], [666779], [666792], [666793], [666808], [666788], [666780], [666789], [666790], [666781], [666791], [666782], [666796], [666797], [666795], [666809], [666810], [666812], [666813], [666811], [672690], [672682], [672686], [672683], [672684], [672685], [672689], [672687], [672664], [672681], [672680], [672665], [672666], [672667], [672676], [672688], [672668], [672660], [672674], [672675], [672691], [672669], [672661], [672670], [672671], [672672], [672662], [672673], [672663], [672678], [672679], [672677], [672722], [672714], [672718], [672715], [672716], [672717], [672721], [672719], [672696], [672713], [672712], [672697], [672698], [672699], [672708], [672720], [672700], [672692], [672706], [672707], [672723], [672701], [672693], [672702], [672703], [672704], [672694], [672705], [672695], [672710], [672711], [672709], [672754], [672746], [672750], [672747], [672748], [672749], [672753], [672751], [672728], [672745], [672744], [672729], [672730], [672731], [672740], [672752], [672732], [672724], [672738], [672739], [672755], [672756], [672733], [672725], [672734], [672735], [672736], [672726], [672737], [672727], [672742], [672743], [672741], [672787], [672779], [672783], [672780], [672781], [672782], [672786], [672784], [672761], [672778], [672777], [672762], [672763], [672764], [672773], [672785], [672765], [672757], [672771], [672772], [672788], [672766], [672758], [672767], [672768], [672769], [672759], [672770], [672760], [672775], [672776], [672774], [672819], [672811], [672815], [672812], [672813], [672814], [672818], [672816], [672793], [672810], [672809], [672794], [672795], [672796], [672805], [672817], [672797], [672789], [672803], [672804], [672820], [672798], [672790], [672799], [672800], [672801], [672791], [672802], [672792], [672807], [672808], [672806], [672849], [672842], [672843], [672844], [672845], [672848], [672846], [672825], [672841], [672840], [672826], [672828], [672827], [672836], [672847], [672829], [672821], [672834], [672835], [672850], [672830], [672822], [672831], [672832], [672823], [672833], [672824], [672838], [672839], [672837], [672851], [672852], [672854], [672855], [672853], [678766], [678758], [678762], [678759], [678760], [678761], [678765], [678763], [678740], [678757], [678756], [678741], [678742], [678743], [678752], [678764], [678744], [678736], [678750], [678751], [678767], [678745], [678737], [678746], [678747], [678748], [678738], [678749], [678739], [678754], [678755], [678753], [678798], [678790], [678794], [678791], [678792], [678793], [678797], [678795], [678772], [678789], [678788], [678773], [678774], [678775], [678784], [678796], [678776], [678768], [678782], [678783], [678799], [678777], [678769], [678778], [678779], [678780], [678770], [678781], [678771], [678786], [678787], [678785], [678830], [678822], [678826], [678823], [678824], [678825], [678829], [678827], [678804], [678821], [678820], [678805], [678806], [678807], [678816], [678828], [678808], [678800], [678814], [678815], [678831], [678832], [678809], [678801], [678810], [678811], [678812], [678802], [678813], [678803], [678818], [678819], [678817], [678863], [678855], [678859], [678856], [678857], [678858], [678862], [678860], [678837], [678854], [678853], [678838], [678839], [678840], [678849], [678861], [678841], [678833], [678847], [678848], [678864], [678842], [678834], [678843], [678844], [678845], [678835], [678846], [678836], [678851], [678852], [678850], [678895], [678887], [678891], [678888], [678889], [678890], [678894], [678892], [678869], [678886], [678885], [678870], [678871], [678872], [678881], [678893], [678873], [678865], [678879], [678880], [678896], [678874], [678866], [678875], [678876], [678877], [678867], [678878], [678868], [678883], [678884], [678882], [678925], [678918], [678919], [678920], [678921], [678924], [678922], [678901], [678917], [678916], [678902], [678904], [678903], [678912], [678923], [678905], [678897], [678910], [678911], [678926], [678906], [678898], [678907], [678908], [678899], [678909], [678900], [678914], [678915], [678913], [678927], [678928], [678930], [678931], [678929], [684835], [684827], [684831], [684828], [684829], [684830], [684834], [684832], [684809], [684826], [684825], [684810], [684811], [684812], [684821], [684833], [684813], [684805], [684819], [684820], [684836], [684814], [684806], [684815], [684816], [684817], [684807], [684818], [684808], [684823], [684824], [684822], [684867], [684859], [684863], [684860], [684861], [684862], [684866], [684864], [684841], [684858], [684857], [684842], [684843], [684844], [684853], [684865], [684845], [684837], [684851], [684852], [684868], [684846], [684838], [684847], [684848], [684849], [684839], [684850], [684840], [684855], [684856], [684854], [684899], [684891], [684895], [684892], [684893], [684894], [684898], [684896], [684873], [684890], [684889], [684874], [684875], [684876], [684885], [684897], [684877], [684869], [684883], [684884], [684900], [684901], [684878], [684870], [684879], [684880], [684881], [684871], [684882], [684872], [684887], [684888], [684886], [684932], [684924], [684928], [684925], [684926], [684927], [684931], [684929], [684906], [684923], [684922], [684907], [684908], [684909], [684918], [684930], [684910], [684902], [684916], [684917], [684933], [684911], [684903], [684912], [684913], [684914], [684904], [684915], [684905], [684920], [684921], [684919], [684964], [684956], [684960], [684957], [684958], [684959], [684963], [684961], [684938], [684955], [684954], [684939], [684940], [684941], [684950], [684962], [684942], [684934], [684948], [684949], [684965], [684943], [684935], [684944], [684945], [684946], [684936], [684947], [684937], [684952], [684953], [684951], [684994], [684987], [684988], [684989], [684990], [684993], [684991], [684970], [684986], [684985], [684971], [684973], [684972], [684981], [684992], [684974], [684966], [684979], [684980], [684995], [684975], [684967], [684976], [684977], [684968], [684978], [684969], [684983], [684984], [684982], [684996], [684997], [684999], [685000], [684998], [690855], [690847], [690851], [690848], [690849], [690850], [690854], [690852], [690829], [690846], [690845], [690830], [690831], [690832], [690841], [690853], [690833], [690825], [690839], [690840], [690856], [690834], [690826], [690835], [690836], [690837], [690827], [690838], [690828], [690843], [690844], [690842], [690887], [690879], [690883], [690880], [690881], [690882], [690886], [690884], [690861], [690878], [690877], [690862], [690863], [690864], [690873], [690885], [690865], [690857], [690871], [690872], [690888], [690866], [690858], [690867], [690868], [690869], [690859], [690870], [690860], [690875], [690876], [690874], [690911], [690913], [690910], [690916], [690909], [690896], [690905], [690917], [690897], [690889], [690903], [690904], [690920], [690921], [690898], [690890], [690899], [690900], [690901], [690891], [690902], [690892], [690907], [690908], [690906], [690952], [690944], [690948], [690945], [690946], [690947], [690951], [690949], [690926], [690943], [690942], [690927], [690928], [690929], [690938], [690950], [690930], [690922], [690936], [690937], [690953], [690931], [690923], [690932], [690933], [690934], [690924], [690935], [690925], [690940], [690941], [690939], [690984], [690976], [690980], [690977], [690978], [690979], [690983], [690981], [690958], [690975], [690974], [690959], [690960], [690961], [690970], [690982], [690962], [690954], [690968], [690969], [690985], [690963], [690955], [690964], [690965], [690966], [690956], [690967], [690957], [690972], [690973], [690971], [691014], [691007], [691008], [691009], [691010], [691013], [691011], [690990], [691006], [691005], [690991], [690993], [690992], [691001], [691012], [690994], [690986], [690999], [691000], [691015], [690995], [690987], [690996], [690997], [690988], [690998], [690989], [691003], [691004], [691002], [691016], [691017], [691019], [691020], [691018], [696920], [696912], [696916], [696913], [696914], [696915], [696919], [696917], [696894], [696911], [696910], [696895], [696896], [696897], [696906], [696918], [696898], [696890], [696904], [696905], [696921], [696899], [696891], [696900], [696901], [696902], [696892], [696903], [696893], [696908], [696909], [696907], [696952], [696944], [696948], [696945], [696946], [696947], [696951], [696949], [696926], [696943], [696942], [696927], [696928], [696929], [696938], [696950], [696930], [696922], [696936], [696937], [696953], [696931], [696923], [696932], [696933], [696934], [696924], [696935], [696925], [696940], [696941], [696939], [696984], [696976], [696980], [696977], [696978], [696979], [696983], [696981], [696958], [696975], [696974], [696959], [696960], [696961], [696970], [696982], [696962], [696954], [696968], [696969], [696985], [696986], [696963], [696955], [696964], [696965], [696966], [696956], [696967], [696957], [696972], [696973], [696971], [697017], [697009], [697013], [697010], [697011], [697012], [697016], [697014], [696991], [697008], [697007], [696992], [696993], [696994], [697003], [697015], [696995], [696987], [697001], [697002], [697018], [696996], [696988], [696997], [696998], [696999], [696989], [697000], [696990], [697005], [697006], [697004], [697049], [697041], [697045], [697042], [697043], [697044], [697048], [697046], [697023], [697040], [697039], [697024], [697025], [697026], [697035], [697047], [697027], [697019], [697033], [697034], [697050], [697028], [697020], [697029], [697030], [697031], [697021], [697032], [697022], [697037], [697038], [697036], [697079], [697072], [697073], [697074], [697075], [697078], [697076], [697055], [697071], [697070], [697056], [697058], [697057], [697066], [697077], [697059], [697051], [697064], [697065], [697080], [697060], [697052], [697061], [697062], [697053], [697063], [697054], [697068], [697069], [697067], [697081], [697082], [697084], [697085], [697083], [703067], [703059], [703063], [703060], [703061], [703062], [703066], [703064], [703041], [703058], [703057], [703042], [703043], [703044], [703053], [703065], [703045], [703037], [703051], [703052], [703068], [703046], [703038], [703047], [703048], [703049], [703039], [703050], [703040], [703055], [703056], [703054], [703099], [703091], [703095], [703092], [703093], [703094], [703098], [703096], [703073], [703090], [703089], [703074], [703075], [703076], [703085], [703097], [703077], [703069], [703083], [703084], [703100], [703078], [703070], [703079], [703080], [703081], [703071], [703082], [703072], [703087], [703088], [703086], [703131], [703123], [703127], [703124], [703125], [703126], [703130], [703128], [703105], [703122], [703121], [703106], [703107], [703108], [703117], [703129], [703109], [703101], [703115], [703116], [703132], [703133], [703110], [703102], [703111], [703112], [703113], [703103], [703114], [703104], [703119], [703120], [703118], [703164], [703156], [703160], [703157], [703158], [703159], [703163], [703161], [703138], [703155], [703154], [703139], [703140], [703141], [703150], [703162], [703142], [703134], [703148], [703149], [703165], [703143], [703135], [703144], [703145], [703146], [703136], [703147], [703137], [703152], [703153], [703151], [703196], [703188], [703192], [703189], [703190], [703191], [703195], [703193], [703170], [703187], [703186], [703171], [703172], [703173], [703182], [703194], [703174], [703166], [703180], [703181], [703197], [703175], [703167], [703176], [703177], [703178], [703168], [703179], [703169], [703184], [703185], [703183], [703226], [703219], [703220], [703221], [703222], [703225], [703223], [703202], [703218], [703217], [703203], [703205], [703204], [703213], [703224], [703206], [703198], [703211], [703212], [703227], [703207], [703199], [703208], [703209], [703200], [703210], [703201], [703215], [703216], [703214], [703228], [703229], [703231], [703232], [703230], [709168], [709160], [709164], [709161], [709162], [709163], [709167], [709165], [709142], [709159], [709158], [709143], [709144], [709145], [709154], [709166], [709146], [709138], [709152], [709153], [709169], [709147], [709139], [709148], [709149], [709150], [709140], [709151], [709141], [709156], [709157], [709155], [709200], [709192], [709196], [709193], [709194], [709195], [709199], [709197], [709174], [709191], [709190], [709175], [709176], [709177], [709186], [709198], [709178], [709170], [709184], [709185], [709201], [709179], [709171], [709180], [709181], [709182], [709172], [709183], [709173], [709188], [709189], [709187], [709232], [709224], [709228], [709225], [709226], [709227], [709231], [709229], [709206], [709223], [709222], [709207], [709208], [709209], [709218], [709230], [709210], [709202], [709216], [709217], [709233], [709234], [709211], [709203], [709212], [709213], [709214], [709204], [709215], [709205], [709220], [709221], [709219], [709265], [709257], [709261], [709258], [709259], [709260], [709264], [709262], [709239], [709256], [709255], [709240], [709241], [709242], [709251], [709263], [709243], [709235], [709249], [709250], [709266], [709244], [709236], [709245], [709246], [709247], [709237], [709248], [709238], [709253], [709254], [709252], [709297], [709289], [709293], [709290], [709291], [709292], [709296], [709294], [709271], [709288], [709287], [709272], [709273], [709274], [709283], [709295], [709275], [709267], [709281], [709282], [709298], [709276], [709268], [709277], [709278], [709279], [709269], [709280], [709270], [709285], [709286], [709284], [709327], [709320], [709321], [709322], [709323], [709326], [709324], [709303], [709319], [709318], [709304], [709306], [709305], [709314], [709325], [709307], [709299], [709312], [709313], [709328], [709308], [709300], [709309], [709310], [709301], [709311], [709302], [709316], [709317], [709315], [709329], [709330], [709332], [709333], [709331], [715205], [715197], [715201], [715198], [715199], [715200], [715204], [715202], [715179], [715196], [715195], [715180], [715181], [715182], [715191], [715203], [715183], [715175], [715189], [715190], [715206], [715184], [715176], [715185], [715186], [715187], [715177], [715188], [715178], [715193], [715194], [715192], [715229], [715231], [715234], [715227], [715212], [715238], [715269], [715261], [715265], [715262], [715263], [715264], [715268], [715266], [715243], [715260], [715259], [715244], [715245], [715246], [715255], [715267], [715247], [715239], [715253], [715254], [715270], [715271], [715248], [715240], [715249], [715250], [715251], [715241], [715252], [715242], [715257], [715302], [715294], [715298], [715295], [715296], [715297], [715301], [715299], [715276], [715293], [715292], [715277], [715278], [715279], [715288], [715300], [715280], [715272], [715286], [715287], [715303], [715281], [715273], [715282], [715283], [715284], [715274], [715285], [715275], [715290], [715291], [715289], [715334], [715326], [715330], [715327], [715328], [715329], [715333], [715331], [715308], [715325], [715324], [715309], [715310], [715311], [715320], [715332], [715312], [715304], [715318], [715319], [715335], [715313], [715305], [715314], [715315], [715316], [715306], [715317], [715307], [715322], [715323], [715321], [715364], [715357], [715358], [715359], [715360], [715363], [715361], [715340], [715356], [715355], [715341], [715343], [715342], [715351], [715362], [715344], [715336], [715349], [715350], [715365], [715345], [715337], [715346], [715347], [715338], [715348], [715339], [715353], [715354], [715352], [715366], [715367], [715369], [715370], [715368], [721370], [721362], [721366], [721363], [721364], [721365], [721369], [721367], [721344], [721361], [721360], [721345], [721346], [721347], [721356], [721368], [721348], [721340], [721354], [721355], [721371], [721349], [721341], [721350], [721351], [721352], [721342], [721353], [721343], [721358], [721359], [721357], [721402], [721394], [721398], [721395], [721396], [721397], [721401], [721399], [721376], [721393], [721392], [721377], [721378], [721379], [721388], [721400], [721380], [721372], [721386], [721387], [721403], [721381], [721373], [721382], [721383], [721384], [721374], [721385], [721375], [721390], [721391], [721389], [721434], [721426], [721430], [721427], [721428], [721429], [721433], [721431], [721408], [721425], [721424], [721409], [721410], [721411], [721420], [721432], [721412], [721404], [721418], [721419], [721435], [721436], [721413], [721405], [721414], [721415], [721416], [721406], [721417], [721407], [721422], [721423], [721421], [721467], [721459], [721463], [721460], [721461], [721462], [721466], [721464], [721441], [721458], [721457], [721442], [721443], [721444], [721453], [721465], [721445], [721437], [721451], [721452], [721468], [721446], [721438], [721447], [721448], [721449], [721439], [721450], [721440], [721455], [721456], [721454], [721499], [721491], [721495], [721492], [721493], [721494], [721498], [721496], [721473], [721490], [721489], [721474], [721475], [721476], [721485], [721497], [721477], [721469], [721483], [721484], [721500], [721478], [721470], [721479], [721480], [721481], [721471], [721482], [721472], [721487], [721488], [721486], [721529], [721522], [721523], [721524], [721525], [721528], [721526], [721505], [721521], [721520], [721506], [721508], [721507], [721516], [721527], [721509], [721501], [721514], [721515], [721530], [721510], [721502], [721511], [721512], [721503], [721513], [721504], [721518], [721519], [721517], [721531], [721532], [721534], [721535], [721533], [727244], [727236], [727240], [727237], [727238], [727239], [727243], [727241], [727218], [727235], [727234], [727219], [727220], [727221], [727230], [727242], [727222], [727214], [727228], [727229], [727245], [727223], [727215], [727224], [727225], [727226], [727216], [727227], [727217], [727232], [727233], [727231], [727276], [727268], [727272], [727269], [727270], [727271], [727275], [727273], [727250], [727267], [727266], [727251], [727252], [727253], [727262], [727274], [727254], [727246], [727260], [727261], [727277], [727255], [727247], [727256], [727257], [727258], [727248], [727259], [727249], [727264], [727265], [727263], [727308], [727300], [727304], [727301], [727302], [727303], [727307], [727305], [727282], [727299], [727298], [727283], [727284], [727285], [727294], [727306], [727286], [727278], [727292], [727293], [727309], [727310], [727287], [727279], [727288], [727289], [727290], [727280], [727291], [727281], [727296], [727297], [727295], [727341], [727333], [727337], [727334], [727335], [727336], [727340], [727338], [727315], [727332], [727331], [727316], [727317], [727318], [727327], [727339], [727319], [727311], [727325], [727326], [727342], [727320], [727312], [727321], [727322], [727323], [727313], [727324], [727314], [727329], [727330], [727328], [727373], [727365], [727369], [727366], [727367], [727368], [727372], [727370], [727347], [727364], [727363], [727348], [727349], [727350], [727359], [727371], [727351], [727343], [727357], [727358], [727374], [727352], [727344], [727353], [727354], [727355], [727345], [727356], [727346], [727361], [727362], [727360], [727403], [727396], [727397], [727398], [727399], [727402], [727400], [727379], [727395], [727394], [727380], [727382], [727381], [727390], [727401], [727383], [727375], [727388], [727389], [727404], [727384], [727376], [727385], [727386], [727377], [727387], [727378], [727392], [727393], [727391], [727405], [727406], [727408], [727409], [727407], [733099], [733091], [733095], [733092], [733093], [733094], [733098], [733096], [733073], [733090], [733089], [733074], [733075], [733076], [733085], [733097], [733077], [733069], [733083], [733084], [733100], [733078], [733070], [733079], [733080], [733081], [733071], [733082], [733072], [733087], [733088], [733086], [733131], [733123], [733127], [733124], [733125], [733126], [733130], [733128], [733105], [733122], [733121], [733106], [733107], [733108], [733117], [733129], [733109], [733101], [733115], [733116], [733132], [733110], [733102], [733111], [733112], [733113], [733103], [733114], [733104], [733119], [733120], [733118], [733163], [733155], [733159], [733156], [733157], [733158], [733162], [733160], [733137], [733154], [733153], [733138], [733139], [733140], [733149], [733161], [733141], [733133], [733147], [733148], [733164], [733165], [733142], [733134], [733143], [733144], [733145], [733135], [733146], [733136], [733151], [733152], [733150], [733196], [733188], [733192], [733189], [733190], [733191], [733195], [733193], [733170], [733187], [733186], [733171], [733172], [733173], [733182], [733194], [733174], [733166], [733180], [733181], [733197], [733175], [733167], [733176], [733177], [733178], [733168], [733179], [733169], [733184], [733185], [733183], [733228], [733220], [733224], [733221], [733222], [733223], [733227], [733225], [733202], [733219], [733218], [733203], [733204], [733205], [733214], [733226], [733206], [733198], [733212], [733213], [733229], [733207], [733199], [733208], [733209], [733210], [733200], [733211], [733201], [733216], [733217], [733215], [733258], [733251], [733252], [733253], [733254], [733257], [733255], [733234], [733250], [733249], [733235], [733237], [733236], [733245], [733256], [733238], [733230], [733243], [733244], [733259], [733239], [733231], [733240], [733241], [733232], [733242], [733233], [733247], [733248], [733246], [733260], [733261], [733263], [733264], [733262], [738973], [738965], [738969], [738966], [738967], [738968], [738972], [738970], [738947], [738964], [738963], [738948], [738949], [738950], [738959], [738971], [738951], [738943], [738957], [738958], [738974], [738952], [738944], [738953], [738954], [738955], [738945], [738956], [738946], [738961], [738962], [738960], [739005], [738997], [739001], [738998], [738999], [739000], [739004], [739002], [738979], [738996], [738995], [738980], [738981], [738982], [738991], [739003], [738983], [738975], [738989], [738990], [739006], [738984], [738976], [738985], [738986], [738987], [738977], [738988], [738978], [738993], [738994], [738992], [739037], [739029], [739033], [739030], [739031], [739032], [739036], [739034], [739011], [739028], [739027], [739012], [739013], [739014], [739023], [739035], [739015], [739007], [739021], [739022], [739038], [739039], [739016], [739008], [739017], [739018], [739019], [739009], [739020], [739010], [739025], [739026], [739024], [739070], [739062], [739066], [739063], [739064], [739065], [739069], [739067], [739044], [739061], [739060], [739045], [739046], [739047], [739056], [739068], [739048], [739040], [739054], [739055], [739071], [739049], [739041], [739050], [739051], [739052], [739042], [739053], [739043], [739058], [739059], [739057], [739102], [739094], [739098], [739095], [739096], [739097], [739101], [739099], [739076], [739093], [739092], [739077], [739078], [739079], [739088], [739100], [739080], [739072], [739086], [739087], [739103], [739081], [739073], [739082], [739083], [739084], [739074], [739085], [739075], [739090], [739091], [739089], [739132], [739125], [739126], [739127], [739128], [739131], [739129], [739108], [739124], [739123], [739109], [739111], [739110], [739119], [739130], [739112], [739104], [739117], [739118], [739133], [739113], [739105], [739114], [739115], [739106], [739116], [739107], [739121], [739122], [739120], [739134], [739135], [739137], [739138], [739136], [744795], [744787], [744791], [744788], [744789], [744790], [744794], [744792], [744769], [744786], [744785], [744770], [744771], [744772], [744781], [744793], [744773], [744765], [744779], [744780], [744796], [744774], [744766], [744775], [744776], [744777], [744767], [744778], [744768], [744783], [744784], [744782], [744827], [744819], [744823], [744820], [744821], [744822], [744826], [744824], [744801], [744818], [744817], [744802], [744803], [744804], [744813], [744825], [744805], [744797], [744811], [744812], [744828], [744806], [744798], [744807], [744808], [744809], [744799], [744810], [744800], [744815], [744816], [744814], [744859], [744851], [744855], [744852], [744853], [744854], [744858], [744856], [744833], [744850], [744849], [744834], [744835], [744836], [744845], [744857], [744837], [744829], [744843], [744844], [744860], [744861], [744838], [744830], [744839], [744840], [744841], [744831], [744842], [744832], [744847], [744848], [744846], [744892], [744884], [744888], [744885], [744886], [744887], [744891], [744889], [744866], [744883], [744882], [744867], [744868], [744869], [744878], [744890], [744870], [744862], [744876], [744877], [744893], [744871], [744863], [744872], [744873], [744874], [744864], [744875], [744865], [744880], [744881], [744879], [744924], [744916], [744920], [744917], [744918], [744919], [744923], [744921], [744898], [744915], [744914], [744899], [744900], [744901], [744910], [744922], [744902], [744894], [744908], [744909], [744925], [744903], [744895], [744904], [744905], [744906], [744896], [744907], [744897], [744912], [744913], [744911], [744954], [744947], [744948], [744949], [744950], [744953], [744951], [744930], [744946], [744945], [744931], [744933], [744932], [744941], [744952], [744934], [744926], [744939], [744940], [744955], [744935], [744927], [744936], [744937], [744928], [744938], [744929], [744943], [744944], [744942]  
       ]    
    
    
    
    
    for id_scheda in check_schede:
    
        logger.info('Provo a leggere i dettagli della scheda {}'.format(id_scheda[0]))
        
        
        params2={'obj':'schede_lavoro',
                'act' : 'r',
                'id': '{}'.format(id_scheda[0]),
                }
        
        response2 = requests.post(eko_url, params=params2, data=auth_data_eko, headers=headers)
        #letture2 = response2.json()
        letture2 = response2.json()
        #logger.info(letture2)
        #exit()
        # key to remove
        #key_to_remove = "status"
        del letture2["status"]  
        del letture2['schede_lavoro'][0]['trips']  
        del letture2['schede_lavoro'][0]['risorse_tecniche']
        del letture2['schede_lavoro'][0]['risorse_umane']
        del letture2['schede_lavoro'][0]['filtri_rfid']        
        #logger.info(letture2)
        
        #logger.info(json.dumps(letture2).encode("utf-8"))
        
        
        
        letture2['schede_lavoro'][0]['servizi'][0]['flg_segn_srv_non_effett']="1"
        letture2['schede_lavoro'][0]['servizi'][0]['txt_segn_srv_non_effett']="UT non soggetta a consuntivazione o situazione da chiarire con COGE"
        letture2['schede_lavoro'][0]['servizi'][0]['id_caus_srv_non_eseg']='15'
        letture2['schede_lavoro'][0]['flg_eseguito']='1'
        letture2['schede_lavoro'][0]['flg_imposta_eseguito']='1'
        
        
        
        
        logger.info('Provo a salvare nuovamente la scheda {}'.format(id_scheda[0]))
        
        
        guid = uuid.uuid4()

        params2={'obj':'schede_lavoro',
                'act' : 'w',
                'ruid': '{}'.format(str(guid)),
                'json': json.dumps(letture2, ensure_ascii=False).encode('utf-8')
                }
        #exit()
        response2 = requests.post(eko_url, params=params2, data=auth_data_eko, headers=headers)
        result2 = response2.json()
        if result2['status']=='error':
            logger.error('Id_scheda = {}'.format(id_scheda))
            logger.error(result2)
    #else :
    #    logger.info(result2['status'])
    
    '''try: 
        id_scheda=letture['crea_schede_lavoro'][0]['id']
    except Exception as e:
        logger.error(e)
    '''




if __name__ == "__main__":
    main()      