#!/usr/bin/env python
# -*- coding: utf-8 -*-

# AMIU copyleft 2023
# Roberto Marzocchi

'''
Lo script si occupa di verificare se ci sono ancora delle schede non eseguite e/o non chiuse per un determinato mese

'''

#from msilib import type_short
import os, sys, re  # ,shutil,glob
import inspect

import requests
from requests.exceptions import HTTPError

import json


#import getopt  # per gestire gli input

#import pymssql
from collections import Counter

from datetime import date, datetime, timedelta

from collections import defaultdict

import locale

import xlsxwriter

import psycopg2

import cx_Oracle

currentdir = os.path.dirname(os.path.realpath(__file__))
parentdir = os.path.dirname(currentdir)
sys.path.append(parentdir)
from credenziali import *



# per mandare file a EKOVISION
import pysftp


#import requests

import logging


filename = inspect.getframeinfo(inspect.currentframe()).filename
path=os.path.dirname(sys.argv[0]) 
path1 = os.path.dirname(os.path.dirname(os.path.abspath(filename)))
nome=os.path.basename(__file__).replace('.py','')
#tmpfolder=tempfile.gettempdir() # get the current temporary directory
logfile='{0}/log/{1}.log'.format(path,nome)
errorfile='{0}/log/error_{1}.log'.format(path,nome)
#if os.path.exists(logfile):
#    os.remove(logfile)







# Create a custom logger
logging.basicConfig(
    level=logging.DEBUG,
    handlers=[
    ]
)

logger = logging.getLogger()

# Create handlers
c_handler = logging.FileHandler(filename=errorfile, encoding='utf-8', mode='w')
#f_handler = logging.StreamHandler()
f_handler = logging.FileHandler(filename=logfile, encoding='utf-8', mode='w')


c_handler.setLevel(logging.ERROR)
f_handler.setLevel(logging.DEBUG)


# Add handlers to the logger
logger.addHandler(c_handler)
logger.addHandler(f_handler)


cc_format = logging.Formatter('%(asctime)s\t%(levelname)s\t%(message)s')

c_handler.setFormatter(cc_format)
f_handler.setFormatter(cc_format)



# Due liste di esempio
lista1 = [637974, 637975, 637976, 637977, 637978, 637979, 637980, 637981, 637982, 637983, 637984, 637985, 637985, 637986, 637986, 637987, 637988, 649304, 637989, 637990, 637991, 637992, 637993, 637994, 637995, 637996, 637997, 637998, 637999, 638000, 638000, 638001, 638001, 638002, 638003, 638004, 638005, 638006, 638007, 638008, 638009, 638010, 638011, 638012, 638013, 638014, 638015, 638015, 638015, 638016, 638016, 638017, 638017, 638018, 638019, 649367, 638020, 638021, 638022, 638023, 638024, 638025, 638026, 638027, 638028, 638029, 638030, 638031, 638031, 638032, 638032, 638033, 638034, 649449, 638035, 638036, 638037, 638038, 638039, 638040, 638041, 638042, 638043, 638044, 638045, 638046, 638046, 638047, 638047, 638048, 638049, 638050, 638050, 644008, 644009, 644010, 644011, 644012, 644013, 644014, 644015, 644016, 644017, 644018, 644019, 644019, 644019, 644020, 644020, 644021, 644021, 644022, 644023, 644024, 644025, 644026, 644027, 644028, 644029, 644030, 644031, 644032, 644033, 644034, 644035, 644035, 644036, 644036, 644037, 644038, 644039, 644040, 644041, 644042, 644043, 644044, 644045, 644046, 644047, 644048, 644049, 644050, 644050, 644051, 644051, 644052, 644053, 644054, 644055, 644056, 644057, 644058, 644059, 644060, 644061, 644062, 644063, 644064, 644065, 644065, 644065, 644066, 644066, 644067, 644067, 644068, 644069, 655497, 644070, 644071, 644072, 644073, 644074, 644075, 644076, 644077, 644078, 644079, 644080, 644081, 644081, 644082, 644082, 644083, 644084, 655537, 644085, 644086, 644087, 644088, 644089, 644090, 644091, 644092, 644093, 644094, 644095, 644096, 644096, 644097, 644097, 644098, 644099, 644100, 644100, 649992, 649993, 649994, 649995, 649996, 649997, 649998, 649999, 650000, 650001, 650002, 650003, 650003, 650003, 650004, 650004, 650005, 650005, 650006, 650007, 661394, 650008, 650009, 650010, 650011, 650012, 650013, 650014, 650015, 650016, 650017, 650018, 650019, 650019, 650020, 650020, 650021, 650022, 650023, 650024, 650025, 650026, 650027, 650028, 650029, 650030, 650031, 650032, 650033, 650034, 650034, 650035, 650035, 650036, 650037, 661453, 650038, 650039, 650040, 650041, 650042, 650043, 650044, 650045, 650046, 650047, 650048, 650049, 650049, 650049, 650050, 650050, 650051, 650051, 650052, 650053, 661541, 650054, 650055, 650056, 650057, 650058, 650059, 650060, 650061, 650062, 650063, 650064, 650065, 650065, 650066, 650066, 650067, 650068, 661618, 650069, 650070, 650071, 650072, 650073, 650074, 650075, 650076, 650077, 650078, 650079, 650080, 650080, 650081, 650081, 650082, 650083, 661635, 650084, 656093, 656094, 656095, 656096, 656097, 656098, 656099, 656100, 656101, 656102, 656103, 656104, 656104, 656104, 656105, 656105, 656106, 656106, 656107, 656108, 656109, 656110, 656111, 656112, 656113, 656114, 656115, 656116, 656117, 656118, 656119, 656120, 656120, 656121, 656121, 656122, 656123, 656124, 656125, 656126, 656127, 656128, 656129, 656130, 656131, 656132, 656133, 656134, 656135, 656135, 656136, 656136, 656137, 656138, 656139, 656140, 656141, 656142, 656143, 656144, 656145, 656146, 656147, 656148, 656149, 656150, 656150, 656151, 656151, 656152, 656152, 656153, 656154, 656155, 656156, 656157, 656158, 656159, 656160, 656161, 656162, 656163, 656164, 656165, 656166, 656166, 656167, 656168, 656169, 656170, 656171, 656172, 656173, 656174, 656175, 656176, 656177, 656178, 656179, 656180, 656181, 656182, 656182, 656183, 656184, 656185, 656185, 667644, 662162, 662163, 662164, 662165, 662166, 662167, 662168, 662169, 662170, 662171, 662172, 662173, 662173, 662173, 662174, 662174, 662175, 662175, 662176, 662177, 662178, 662179, 662180, 662181, 662182, 662183, 662184, 662185, 662186, 662187, 662188, 662189, 662189, 662190, 662190, 662191, 662192, 662193, 662194, 662195, 662196, 662197, 662198, 662199, 662200, 662201, 662202, 662203, 662204, 662205, 662205, 662206, 662207, 662208, 662209, 662210, 662211, 662212, 662213, 662214, 662215, 662216, 662217, 662218, 662219, 662219, 662219, 662220, 662220, 662221, 662221, 662222, 662223]
lista2 = [637974, 637975, 637976, 637977, 637978, 637979, 637980, 637981, 637982, 637983, 637984, 637985, 637986, 637987, 637988, 649304, 637989, 637990, 637991, 637992, 637993, 637994, 637995, 637996, 637997, 637998, 637999, 638000, 638001, 638002, 638003, 638004, 638005, 638006, 638007, 638008, 638009, 638010, 638011, 638012, 638013, 638014, 638015, 638016, 638017, 638018, 638019, 649367, 638020, 638021, 638022, 638023, 638024, 638025, 638026, 638027, 638028, 638029, 638030, 638031, 638032, 638033, 638034, 649449, 638035, 638036, 638037, 638038, 638039, 638040, 638041, 638042, 638043, 638044, 638045, 638046, 638047, 638048, 638049, 638050, 644008, 644009, 644010, 644011, 644012, 644013, 644014, 644015, 644016, 644017, 644018, 644019, 644020, 644021, 644022, 644023, 644024, 644025, 644026, 644027, 644028, 644029, 644030, 644031, 644032, 644033, 644034, 644035, 644036, 644037, 644038, 644039, 644040, 644041, 644042, 644043, 644044, 644045, 644046, 644047, 644048, 644049, 644050, 644051, 644052, 644053, 644054, 644055, 644056, 644057, 644058, 644059, 644060, 644061, 644062, 644063, 644064, 644065, 644066, 644067, 644068, 644069, 655497, 644070, 644071, 644072, 644073, 644074, 644075, 644076, 644077, 644078, 644079, 644080, 644081, 644082, 644083, 644084, 655537, 644085, 644086, 644087, 644088, 644089, 644090, 644091, 644092, 644093, 644094, 644095, 644096, 644097, 644098, 644099, 644100, 649992, 649993, 649994, 649995, 649996, 649997, 649998, 649999, 650000, 650001, 650002, 650003, 650004, 650005, 650006, 650007, 661394, 650008, 650009, 650010, 650011, 650012, 650013, 650014, 650015, 650016, 650017, 650018, 650019, 650020, 650021, 650022, 650023, 650024, 650025, 650026, 650027, 650028, 650029, 650030, 650031, 650032, 650033, 650034, 650035, 650036, 650037, 661453, 650038, 650039, 650040, 650041, 650042, 650043, 650044, 650045, 650046, 650047, 650048, 650049, 650050, 650051, 650052, 650053, 661541, 650054, 650055, 650056, 650057, 650058, 650059, 650060, 650061, 650062, 650063, 650064, 650065, 650066, 650067, 650068, 661618, 650069, 650070, 650071, 650072, 650073, 650074, 650075, 650076, 650077, 650078, 650079, 650080, 650081, 650082, 650083, 661635, 650084, 656093, 656094, 656095, 656096, 656097, 656098, 656099, 656100, 656101, 656102, 656103, 656104, 656105, 656106, 656107, 656108, 656109, 656110, 656111, 656112, 656113, 656114, 656115, 656116, 656117, 656118, 656119, 656120, 656121, 656122, 656123, 656124, 656125, 656126, 656127, 656128, 656129, 656130, 656131, 656132, 656133, 656134, 656135, 656136, 656137, 656138, 656139, 656140, 656141, 656142, 656143, 656144, 656145, 656146, 656147, 656148, 656149, 656150, 656151, 656152, 656153, 656154, 656155, 656156, 656157, 656158, 656159, 656160, 656161, 656162, 656163, 656164, 656165, 656166, 656167, 656168, 656169, 656170, 656171, 656172, 656173, 656174, 656175, 656176, 656177, 656178, 656179, 656180, 656181, 656182, 656183, 656184, 656185, 667644, 662162, 662163, 662164, 662165, 662166, 662167, 662168, 662169, 662170, 662171, 662172, 662173, 662174, 662175, 662176, 662177, 662178, 662179, 662180, 662181, 662182, 662183, 662184, 662185, 662186, 662187, 662188, 662189, 662190, 662191, 662192, 662193, 662194, 662195, 662196, 662197, 662198, 662199, 662200, 662201, 662202, 662203, 662204, 662205, 662206, 662207, 662208, 662209, 662210, 662211, 662212, 662213, 662214, 662215, 662216, 662217, 662218, 662219, 662220, 662221, 662222, 662223]

# Elementi presenti in lista1 ma non in lista2
solo_in_lista1 = list(set(lista1) - set(lista2))

# Elementi presenti in lista2 ma non in lista1
solo_in_lista2 = list(set(lista2) - set(lista1))

# Differenze totali (simmetrica)
differenze = list(set(lista1) ^ set(lista2))

logger.info(len(solo_in_lista1))
logger.info(len(solo_in_lista2))
logger.info("Solo in lista1: {}".format(solo_in_lista1))
logger.info("Solo in lista2: {}".format(solo_in_lista2))
#print("Differenze totali:", differenze)




# Conta le occorrenze
conta = Counter(lista1)

# Estrae solo i valori che compaiono piÃ¹ di una volta
ripetuti = {val: occorrenze for val, occorrenze in conta.items() if occorrenze > 1}

# Numero totale di elementi ripetuti (tutte le occorrenze meno la prima)
totale_ripetizioni = sum(occorrenze - 1 for occorrenze in ripetuti.values())

logger.info("Valori ripetuti:", ripetuti)
logger.info("Numero totale di ripetizioni:", totale_ripetizioni)


